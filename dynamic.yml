tls:
  certificates:
    - certFile: "/etc/certs/cert.pem"
      keyFile: "/etc/certs/key.pem"

  options:
    default:
      minVersion: VersionTLS12
      cipherSuites:
        - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
        - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
        - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
      sniStrict: true

http:
  routers:
    app-router:
      rule: "Host(`app.localhost`)"
      entryPoints:
        - websecure
      service: app-service
      tls: 
        options: default

    # Router for the backend, listens on /api
    backend-router:
      rule: "Host(`app.localhost`) && PathPrefix(`/api`)"
      entryPoints:
        - websecure
      service: backend-service
      tls: 
        options: default


  services:
    app-service:
      loadBalancer:
        servers:
          - url: "http://frontend-https:3030" 

    # Service for the backend
    backend-service:
      loadBalancer:
        servers:
          - url: "http://bff-https:80"
